# 数组和指针（上）

**数组和指针并不相同，只是有类似的地方。**

## 定义和声明

```c
int a=10;  // 定义变量
int b;
b=10;      //声明变量
```

声明是指普通的声明，声明的不是本身，而是在其他地方创建的对象；声明时不会开辟空间，故声明数组时不需要提供关于数组的长度，对于多维数组，需提供除最左边一维之外其他维的长度。

定义是指特殊的声明，会直接开辟空间。

## 左值和右值

变量由空间、内容、类型组成。

```c
int a=10;
int b=a;
```

其中，a=10，a代表变量空间，称为左值。（左值一般位于表达式左边，但不绝对，必须是变量，即可修改其内容才能位于表达式的左边）

b=a，a代表变量内容，称为右值。（右值一般位于表达式右边，但也不绝对）

## 数组

##### 定义：相似元素的集合。（元素：C语言中所有类型）

#### 1.数组传参时会发生降维现象，即不管几维数组传参时均会降维为指针。

#### 2.传参时均会形成临时变量。

```c
void fun(int arr[],int sz)
{
    
}
int main()
{
    int arr[]={1,2,3};
    int sz=sizeof(arr)/sizeof(arr[0]);
    fun(arr,sz);
    return 0;
}
```

##### 3.传参时形参数组 void fun(int arr[]),[]为下标操作符，里面的数字可省略（可不写可为任何数字），因为没有实际意义。

##### 4.规定中，左值必须为可修改的值，虽数组名也可确定对象在内存中的数据，也是左值，但不可作为赋值的对象，因数组名是不可修改的值。

##### 5.数组类型是由数组类型和元素个数共同决定。

##### 6.数组可直接访问数据，例如a[1]，相当于获得a+1这个地址访问其数据。

##### 7.数组名只能表示整个数组的两种特殊情况

```c
int main()
{
    char arr[]={'b','a','t'};
    printf("%d\n",sizeof(arr));
    printf("%d\n",sizeof(arr+1));
    printf("%p\n",&arr);
}
```

(1)sizeof（arr），只有数组名时代表整个数组，若增添任何运算，数组名就变为首元素的地址；

（2）&arr，取地址数组名时，代表整个数组。

其他情况数组名均代表首元素的地址。

### 8.所有数组均为一维数组。

## 指针

### 定义：指针是地址。

```c
int main()
{
    char *p;
    c=*p;
}
```

##### 1.间接访问数据；指针访问时先定义一个指针p，这个指针指向某个空间，对其解引用访问数据。

2.定义指针时，系统并不为指针所指向的对象分配空间，只分配指针本身的空间。

```c
int main()
{
    char *p="hello";
    char arr[]="hello";
}
```

   除非在定义指针时用字符串初始化，此时系统会为其开辟空间。但此时字符串被定义为只读，不可通过指针修改，有些编译器中，字符串常量被放置于只允许读取的文本段中,故指针释放后，字符串内容还存在；数组如果用字符串常量初始化，后面可进行修改，数组释放时字符串内容同时也释放。

```c
int main()
{
    char a[]="abcdefght";
    strncpy(a,"black",5);  //修改数组的值
}
//结果为blackfght
```

##### 3.下标总是与指针的偏移量相同

```c
int main()
{
    int a[10];
    int *p;
    int i=2;
    
    p=a;
    p[i];   //(1)
    
    p=a;
    *(p+i);   //(2)
    
    p=a+i;
    *p;    //(3)
}
```

用指针访问a[i],以上三种方式均可。

#### 指针数组

##### 指针数组着重点在数组，即为存放指针的数组。

#### 数组指针

##### 数组指针是指针，是能指向数组的指针，所以数组指针中存放的应该是数组的地址。

```c
int main()
{
    int *p1[10];
    char (*p2)[10];
}
```

那么这两个哪个是指针数组，哪个是数组指针呢？

在c语言中，基本操作符的运算级下表操作符（[]）在解引用操作符（*）之上，故第一个p1先与[]结合，p1是数组，int *p1[10]表示整形指针的数组；第二个（）的优先级最高，故p2先解引用操作符结合，p2为指针,表示指向字符型数组的指针。

##### 注意：对指针+1等于加所指向类型的大小。在32位平台下，二级指针以上+1均是+4个字节。

二维数组会降维为数组指针。

```c
void fun(int (*p)[5],int sz)
{
    
}
int main()
{
    int arr[10][5];
    int sz=sizeof(arr)/sizeof(arr[0]);
    fun(arr,sz);
    return 0;
}
```

因为在认知上其实所有数组都是一维数组。这怎么理解呢？

一维数组编译器在开辟空间时为连续的线性空间。二维数组书本上常见的几行几列只是为了方便我们理解，实际上在内存中存储时二维数组也是线性存储，可以将其理解为一行为数组的一个数值，一行又有5个数组，故传参时降维为数组指针。

##### 注意:在32位平台下，所有指针类型传参时均消耗4个字节，形成指针临时变量。





